::::: {.content-visible when-meta="assemble"}

## Assembly

```{python}
if assemble and "hifiasm" in multiqc.list_modules():
    display(multiqc.get_plot("hifiasm", "HiFiasm kmer graph").show())
```

```{python}
#| output: asis
if assemble and glob.glob(f"{log_path}/*-raw-*.assembly_summary"):
    displayGfastatsAssemblySummary(f"{log_path}/*-raw-*.assembly_summary")
```

```{python}
#| output: asis
if assemble and glob.glob(f"{log_path}/*-raw-*_merquryfk.completeness.stats"):
    displayAssemblyCompleteness(f"{log_path}/*-raw-*_merquryfk.completeness.stats")
    displayAssemblyQualityValue(f"{log_path}/*-raw-*_merquryfk.qv")
    if(glob.glob(f"{log_path}/*-raw-*_merqury.*.qv")):
        displayScaffoldQualityValue(f"{log_path}/*-raw-*_merqury.*.qv")
```

##### Copy number spectra

:::: {.panel-tabset}

## MerquryFK

```{python}
# TODO account for multiple assemblers
# TODO: Add ln plot too see the relative contribution
if assemble and glob.glob(f"{log_path}/*-raw-*_merquryfk.*.spectra-cn.st.png"):
    display(Image(filename=glob.glob(f"{log_path}/*-raw-*_merquryfk.*.spectra-cn.st.png")[0]))
else:
    print("Raw Assembly MerquryFK copy number spectra not available")
```

## Merqury

```{python}
# TODO This path will be different depending on phased or not
if assemble and glob.glob(f"{log_path}/*-raw-*_merqury.*.spectra-cn.st.png"):
    display(Image(filename=glob.glob(f"{log_path}/*-raw-*_merqury.*.spectra-cn.st.png")[0]))
else:
    print("Raw Assembly Merqury copy number spectra not available")
```

::::

##### Assembly spectra

:::: {.panel-tabset}

## MerquryFK

```{python}
# TODO account for multiple assemblers
if assemble and glob.glob(f"{log_path}/*-raw-*_merquryfk.spectra-asm.st.png"):
    display(Image(filename=glob.glob(f"{log_path}/*-raw-*_merquryfk.spectra-asm.st.png")[0]))
else:
    print("Raw Assembly MerquryFK spectra not available")
```

## Merqury

```{python}
if assemble and glob.glob(f"{log_path}/*-raw-*_merqury.spectra-asm.st.png"):
    display(Image(filename=glob.glob(f"{log_path}/*-raw-*_merqury.spectra-asm.st.png")[0]))
else:
    print("Raw Merqury Assembly spectra not available")
```

::::

##### False duplications

```{python}
#| output: asis
if assemble and glob.glob(f"{log_path}/*-raw-*_merquryfk.false_duplications.tsv"):
    print(
        pd.read_csv(
            glob.glob(f"{log_path}/*-raw-*_merquryfk.false_duplications.tsv")[0], sep="\t"
        ).to_markdown(index=False)
    )
else:
    print("Merqury FK false duplications not available")
```

#### Assembly gene space completeness

```{python}
if assemble and "busco" in multiqc.list_modules():
    for lineage in multiqc.list_plots()["busco"]:
        display(multiqc.get_plot("busco", f"{lineage}").show())
```

### Other assemblies
TODO for each assembly output a stats section (expandable).

:::::
